#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <jsonrpccpp/client.h>

#include "cryptonight.h"

int main(int argc, char * argv[])
{
	unsigned char hash[128];
	int i = 0;
	//char input [48] = {0xc1,0x8c,0xcd,0xca,0xe7,0x63,0x46,0x3d,0x46,0x83,0x67,0xfb,0x35,0x91,0xaf,0xa7,0xb7,0xaa,0x2e,0x53,0xea,0x73,0x93,0x2d,0xf1,0x65,0xdc,0x2c,0x9f,0x98,0x1a,0xe8,0,0,0,0,0,0,0,0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
	//char input [48] = {0xc1,0x8c,0xcd,0xca,0xe7,0x63,0x46,0x3d,0x46,0x83,0x67,0xfb,0x35,0x91,0xaf,0xa7,0xb7,0xaa,0x2e,0x53,0xea,0x73,0x93,0x2d,0xf1,0x65,0xdc,0x2c,0x9f,0x98,0x1a,0xe8,0,0,0,0,0,0,0,0,0x43,0xfb,0x91,0xed,0xfc,0x72,0xa8,0x46};
	//char input [48] = {0xe8,0x1a,0x98,0x9f,0x2c,0xdc,0x65,0xf1,0x2d,0x93,0x73,0xea,0x53,0x2e,0xaa,0xb7,0xa7,0xaf,0x91,0x35,0xfb,0x67,0x83,0x46,0x3d,0x46,0x63,0xe7,0xca,0xcd,0x8c,0xc1,0,0,0,0,0,0,0,0,0x46,0xa8,0x72,0xfc,0xed,0x91,0xfb,0x43};
	//char input[48] = {0x33,0x5d,0x79,0xfa,0xdf,0x21,0x8d,0x42,0xe1,0x89,0x3d,0x2d,0xcf,0x1d,0x31,0x03,0xfe,0x09,0xe4,0x24,0x19,0x70,0x22,0x2c,0x4e,0xba,0x1c,0xb1,0xbf,0x95,0xd5,0x67,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
	//char input[48] = {0x67,0xd5,0x95,0xbf,0xb1,0x1c,0xba,0x4e,0x2c,0x22,0x70,0x19,0x24,0xe4,0x09,0xfe,0x03,0x31,0x1d,0xcf,0x2d,0x3d,0x89,0xe1,0x42,0x8d,0x21,0xdf,0xfa,0x79,0x5d,0x33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
	char input[48] = {0xf5,0x73,0x2b,0x55,0x45,0x18,0x65,0xbd,0x2e,0xae,0x7b,0xf8,0x5c,0xb8,0x10,0x53,0x57,0x8a,0x8f,0xf7,0xff,0xd4,0xb3,0x03,0x1a,0x8d,0x8a,0xb6,0xbe,0x47,0x42,0xee,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

	unsigned int nonce = atoi(argv[1]);
	while(true){
		memcpy(&input[40], &nonce, 4);
		cryptonight_hash(hash, input, 48);
		//if ((nonce & 0xff) == 0) printf("%u\n",nonce);
		if (hash[0] == 0){
			for (i = 0; i < 32; i++)printf("%02x", hash[i]);
			printf(".%0x\n", nonce);
		}
		nonce++;
	}
	return 0;
}

// gcc -I/usr/include/jsoncpp -I/usr/include/jsonrpccpp -o vnsminer -g vnsminer.cpp -L./build -lcryptonight
// ref: https://cryptonote.org/cns/cns008.txt
